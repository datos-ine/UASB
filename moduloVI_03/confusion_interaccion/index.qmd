---
format: 
  revealjs: 
    chalkboard: true
    logo: logos_ine.png
    incremental: false
    slide-number: true
    #footer: "Programa de Maestría en Epidemiología para la Salud Pública"
    css: custom.css
---

```{r}
#| echo: false
# Configuración global
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.align = "center")

# Paquetes necesarios
pacman::p_load(
  flextable,
  patchwork,
  rio,
  janitor,
  equatiomatic,
  tidyverse
)
```

## Módulo VI: Análisis Epidemiológico Avanzado {.center style="text-align: center;"}

:::: {style="margin-top: 1.5em;"}
Docentes: Tamara Ricardo, Christian Ballejo

::: {style="font-size: .75em; margin-bottom: 1.5em;"}
Programa de Maestría en Epidemiología para la Salud Pública
:::

![](logos_ine.png){fig-align="center" width="70%"}
::::

## OBJETIVOS DE LA UNIDAD

::: incremental
-   **Desarrollar habilidades en el uso de la estadística** como herramienta para la investigación epidemiológica.

-   **Adquirir competencias básicas en R y RCommander** para realizar análisis de datos en salud pública.

-   Aprender a ajustar, interpretar y evaluar modelos de **regresión lineal simple y múltiple**.

-   **Comprender los conceptos de confusión e interacción** y su impacto en los análisis estadísticos.
:::


## PROGRAMA DE LA UNIDAD

::: {style="margin-top: 2em;"}
```{r}
# Genera datos para la tabla 
tibble(Semana = c(rep("30 oct. al 03 nov. 2024", 2), 
                  rep("06 al 09 nov. 2024", 2),
                  "13 al 16 nov. 2024", ""),      
          
      Tema = c("- Introducción a los paquetes / lenguajes estadísticos: GUI vs CLI; privativos vs gratuitos/open source.",
               "- R / R-Commander: Menúes; Lectura de archivos de datos; Estadística descriptiva; Agrupamiento de variables; Factores; Guardado de script y resultados; Paquetes y plugins).",
               "- Relación entre variables: Covarianza; Correlación (Pearson, Spearman, Kendall).",
               "- Regresión lineal simple: Presupuestos; Bondad de ajuste; Coeficiente de determinación; Análisis de residuales; Interpretación.",
               "- Regresión lineal múltiple: Selección de variables; Multicolinealidad.",
               "- Confusión e interacción.")
      ) |>    
  
  #  Genera tabla    
  flextable() |>    
  bold(part = "header") |> 
  fontsize(size = 16, part = "all") |>   
  merge_v() |>  
  color(i = 1:5, color = "gray40") |> 
  highlight(i = 6, color = "#FFB90F") |> 
  autofit() 
```
:::

## OBJETIVOS DE HOY

::: incremental
- Comprender los conceptos de confusión e interacción en los estudios epidemiológicos.

- Detectar las variables confusoras y modificadoras de efecto en las regresiones lineales.

- Interpretar los coeficientes correctamente frente al ajuste en la regresión.  

:::

## CONFUSIÓN {transition="zoom"}

::: {.callout-tip icon=false style="font-size: 1.2em;"}
## Confusión (del latín confundere, mezclar)

En términos generales, es la distorsión de una medida del efecto de una exposición sobre un resultado debido a la asociación de la exposición con otros factores que influyen en la ocurrencia del resultado. 
La confusión se produce cuando toda o parte de la asociación aparente entre la exposición y el resultado se explica de hecho por otras variables que afectan al resultado y que no se ven afectadas por la exposición.
:::

*M. Porta - A Dictionary of Epidemiology - 6th Edition - 2016*

## CONFUSIÓN

Por lo tanto, una variable confusora es una variable que distorsiona la medida de asociación entre las variables principales. El resultado, en presencia de una variable de confusión, puede ser la observación de:

. . .  

- Efecto donde en realidad no existe (asociación espuria)
 
. . .  
 
- Exageración o atenuación de una asociación real (confusión positiva)

. . .  

- Inversión del sentido de una asociación real (confusión negativa) - paradoja de Simpson

## CONFUSIÓN

::: incremental

- La variable confusora puede ser "real" dentro del modelo teórico estudiado y haberse recolectado en los datos (por ejemplo, la edad y el sexo son variables confusoras en muchos procesos de salud-enfermedad)

- La variable confusora puede estar representada en los datos debido al desequilibrio de los grupos (heterogeneidad) pero no tener efecto confusor real en el modelo teórico.

- Podría existir una variable confusora dentro del modelo teórico y no haberse medido (variable no observada - análisis de sensibilidad)

:::

## CONFUSIÓN PRODUCTO DE OTROS SESGOS 

Ejemplos de causas de la confusión en estudios observacionales 

::: {.fragment .fade-in-then-semi-out}

- Confusión por indicación: Al evaluar el efecto de un medicamento en particular, muchas veces las personas que toman el medicamento difieren de las que no lo toman según la indicación médica para la que se prescribe el medicamento. 

:::

## CONFUSIÓN PRODUCTO DE OTROS SESGOS 

::: {.fragment .fade-in-then-semi-out}

- Sesgo de selección: No todas las personas invitadas a participar en un estudio participan, lo que causa un desequilibrio entre los grupos. 

:::

::: {.fragment .fade-in-then-semi-out}

- Sesgo de recuerdo: No todas las personas con una exposición recuerdan su historial de exposición correctamente, lo que quizás cause un recuerdo desigual en diferentes grupos. 

:::

## MODELOS TEÓRICOS - DAG

Para conceptualizar este y otros mecanismos en epidemiología se suele utilizar *grafos acíclicos dirigidos* (**DAG**s en inglés). 

- Su nombre se debe a que no forman un ciclo cerrado y las variables están unidas por flechas dirigidas.

- Se aplican en la inferencia causal para abordar estudios observacionales y a partir de las asociaciones asegurar relaciones causales entre las variables.

- Permiten visualizar el modelo teórico de manera sencilla y controlar sesgos, variables confusoras, etc, 

## DAG - SIMPLE

```{dot}
//| echo: false
//| fig-width: 8
digraph G {
  rankdir="LR";
  ratio = compress;
  size=10;
  margin=0;
  exposicion->desenlace
}

```

## ROL DE LAS VARIABLES

Además de las variables de exposición y desenlace (medida o evento de interés), las variables pueden tomar diferentes roles:

::: incremental

- Mediadora

- Confusora

- Modificadora de efecto

- Colisionadora

- Antecesora

- No observada

:::

## VARIABLES CONFUSORAS

<br>

- Una variable cumple el rol de confusora, si:

- Se asocia con la exposición.

- Se asocia con el desenlace.

Nota: la variable confusora no puede ser un paso intermedio en la vía causal entre la exposición y el desenlace (variable mediadora).


## DAG - CONFUSION

```{dot}
//| echo: false
//| fig-width: 8
digraph G {
  ratio = compress;
  size=8;
  margin=0;
  ranksep = 0.6;
  confusor->desenlace
  confusor->exposicion
  exposicion->desenlace
  
  subgraph x {
        
            rank = same;
            exposicion; desenlace; 
        
  }
}

```


## PARADOJA DE SIMPSON

Es el caso de confusión en sentido negativo, cuando se invierte el sentido de una asociación. 

- Descripta en 1951 por Edward Simpson y conocida también bajo el nombre "efecto Yule-Simpson"

- Existe como caso de confusión en muchas situaciones de la epidemiología, como por ejemplo en la vacunación de COVID-19, aprovechado por grupos antivacunas que decían que se morian mas vacunados que no vacunados (tasas crudas globales), haciendo que la edad confundiera la relación.



## PARADOJA DE SIMPSON {.smaller}

Un ejemplo claro lo observamos aquí: si analizamos los datos totales, vemos que un 75% de las personas que fallecieron en accidentes de tráfico llevaba el cinturón de seguridad (110 de 145), llegando a la conclusión (errónea) de que el cinturón de seguridad no es eficaz. 

Sin embargo, si analizamos los datos por subgrupos, vemos que en los accidentes sin cinturón mueren el 70% de las personas (35 de 50) y en aquellos donde las personas llevaban el cinturón mueren solo el 11% (110 de 950). Es la conclusión contraria a la anterior.

![](images/cinturon.webp){fig-align="center"}

## CONTROL DE LA CONFUSIÓN

- En el diseño del estudio:
  - Aleatorización (estudios experimentales)
  - Restricción
  - Pareamiento

- Al momento de analizar los datos:
  - Estandarización (ajuste de tasas)
  - Estratificación 
  - Modelos multivariados (ajuste).

## CONTROL EN EL DISEÑO {.smaller}

<br>

**Aleatorización**

El objetivo de la asignación al azar de los tratamientos (exposición), que solo se puede hacer en los **estudios experimentales**, es lograr la formación de grupos homogéneos en lo que se refiere a todas las características que puedan influir en el riesgo de desarrollar el evento (edad, sexo, masa corporal u otras características que no se puedan medir), lo que se busca lograr es que los grupos sean similares en todo excepto en la exposición que se busca evaluar.

**Restricción**

La restricción limita el estudio a personas que tienen características especiales.Por ejemplo, para controlar la edad se puede restringir la muestra a un grupo de edad específico al momento de diseñar el estudio.

## CONTROL EN EL DISEÑO  {.smaller}

<br>

**Apareamiento**

Cuando se controla el fenómeno de confusión mediante apareamiento o emparejamiento,
los participantes en el estudio (por ejemplo, casos y controles) se seleccionan de manera que los potenciales factores de confusión se encuentren distribuidos de forma similar en los dos grupos que van a compararse.

Por ejemplo, un estudio caso-control para investigar la relación entre la exposición al humo de tabaco (exposición) y el riesgo de cáncer de pulmón (desenlace).

Emparejas cada caso con un control que tenga el mismo sexo y una edad similar (ej: dentro de 5 años de diferencia).

## CONTROL EN EL ANÁLISIS {.smaller}

<br>

**Estandarización**

Es una técnica estadística utilizada para controlar variables confusoras al comparar tasas (como tasas de incidencia o mortalidad) entre diferentes poblaciones. Permite ajustar las diferencias en la distribución de variables como la edad, género u otras características demográficas que podrían influir en las tasas. Existen métodos directos e indirectos.

**Estratificación**

Consiste en dividir los datos en estratos según los valores de una o más confusoras y luego analizar la asociación entre exposición y desenlace dentro de cada estrato.Permite observar la asociación en subgrupos homogéneos, eliminando el sesgo por confusión en cada estrato.

## ANALISIS MULTIVARIADO


Todos los modelos de regresión posibilitan incluir variables confusoras o potencialmente confusoras que se ajustan en la relación entre la exposición y el desenlace, proporcionando una estimación del efecto controlado por el impacto de estos confusores. 

Es importante desarrollar el modelo teórico del objeto que se está estudiando para caracterizar el verdadero rol de cada covariable y así identificar estas potenciales confusoras para ajustar adecuadamente la regresión.


## INTERPRETACIÓN EN LA RLM

<br>

En términos generales, se habla de confusión cuando existen diferencias estadísticas importantes entre las estimaciones brutas de una asociación y las ajustadas por los posibles factores de confusión. 

Existe un consenso en la bibliografía: un factor puede considerarse de confusión cuando su ajuste es responsable de un cambio de al menos un **10%** en la magnitud de la diferencia entre las estimaciones ajustadas y las brutas.


## SOSPECHA EN LA EXPLORACIÓN {.smaller}

<br>

Los gráficos estadísticos pueden ser herramientas muy útiles para sospechar la presencia de confusión al observar la relación entre la exposición y el desenlace junto con posibles variables confusoras.

- Si al observar los gráficos se detecta que los patrones entre exposición y desenlace cambian al controlar visualmente por una tercera variable, eso sugiere una posible confusión.

- Si encontramos diferencias significativas en la distribución de una variable confusora entre grupos de exposición también pueden indicar confusión.

- Gráficos de dispersión, de barras apiladas o segmentadas y boxplots son útiles para explorar estas situaciones.

## SOSPECHA EN LA EXPLORACIÓN

incluir grafico de ejemplo

## EJEMPLO 

El volumen espiratorio forzado (VEF1) es un índice de la función pulmonar que mide el volumen de aire expulsado 
después de 1 segundo de esfuerzo constante. En 1970 se realizó un estudio de enfermedades respiratorias infantiles (ERC) con 654 niños de 3 a 19 años de East Boston, Massachusetts. 

En una tabla se recolectaron los datos de VEF, TABACO (si fuma o no), SEXO, EDAD, ALTURA (centímetros).

Una de las preguntas de investigación fue ¿si el fumar afecta la capacidad pulmonar?

------------------------------------------------------------------------

La regresión lineal simple (relación cruda) entre tabaco y el vef resulta:

![](images/confusion1.PNG){fig-align="center"}

Es decir la ecuación de la RL sería:

```{r}
vef <- read_csv2("vef2.txt")

crudo <- lm(vef ~ tabaco, data = vef)

extract_eq(crudo, use_coefs = T)
```

------------------------------------------------------------------------

La regresión lineal múltiple (relación ajustada por EDAD) es de:

![](images/confusion2.PNG){fig-align="center"}

```{r}
ajustado_edad <- lm(vef ~ tabaco + edad, data = vef)

extract_eq(ajustado_edad, use_coefs = T)
```

$$
\frac{0.27 - (-0.09)}{0.27} * 100 = 133.33
$$

------------------------------------------------------------------------

La regresión lineal múltiple (relación ajustada por ALTURA) es:

![](images/confusion3.PNG){fig-align="center"}

. . .

La variable confusora ALTURA provoca que la variable TABACO pierda significación.

Además el $R^2$ ajustado aumenta del 6 al 60 %, evidenciando que ALTURA explica mucho más de la variabilidad de VEF por si sola. 

------------------------------------------------------------------------







## VARIABLES MEDIADORAS

No se debe incluir como factor de confusión a una variable que se ubica en el paso intermedio de la vía causal entre la exposición y el desenlace.

A estas variables se las denominan mediadoras y no se deben ajustar en un modelo de regresión múltiple.

Un ejemplo, es la relación entre tabaquismo (exposición) y enfermedad cardiovascular (resultado), donde hipertensión (mediadora) actúa como un mecanismo intermedio.

Si se la incluye, estaremos midiendo el efecto directo e indirecto

## DAG - MEDIADORA

```{dot}
//| echo: false
//| fig-width: 8
digraph G {
  ratio = compress;
  size=8;
  margin=0;
  ranksep = 0.6;
  mediadora->desenlace
  exposicion->mediadora
  exposicion->desenlace
  
  subgraph x {
            rank = same;
            exposicion; desenlace; 
        
  }
}

```

## EJEMPLO {.smaller}

<br>

Imaginemos un estudio sobre la relación entre `actividad física` (**exposición**), índice de masa corporal - `IMC` (**mediadora**), y riesgo de `diabetes` (**desenlace**):

**Efecto directo**: Al incluir el IMC en el modelo, obtienes el efecto de la actividad física sobre el riesgo de diabetes independientemente de los cambios en el IMC.

**Efecto indirecto**: Parte del efecto de la actividad física sobre el riesgo de diabetes ocurre a través de la reducción del IMC. Este efecto indirecto solo puede estimarse modelando la relación entre actividad física y IMC y luego el impacto del IMC sobre la diabetes.

**Efecto total**: Si no incluyeras el IMC en el modelo, obtendrías el efecto total de la actividad física en el riesgo de diabetes, que incluye tanto los efectos directos como los indirectos.


## INTERACCIÓN{transition="zoom"}

<br>

::: {.callout-note icon=false style="font-size: 1.2em;"}

## Modificación de efecto (sin.: modificación de medida de efecto) 

Variación en la medida de efecto seleccionada para el factor en estudio a través de los niveles de otro factor.

:::

*M. Porta - A Dictionary of Epidemiology - 6th Edition - 2016*

## SOSPECHA EN LA EXPLORACIÓN

sospecha en gráficos - ejemplo

## INTERPRETACIÓN EN LA RLM

interpretación de coeficientes en la RLM
ejemplos


## EJEMPLO EN RCOMMANDER

ejemplo VEF